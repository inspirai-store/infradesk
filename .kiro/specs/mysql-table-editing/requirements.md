# MySQL 表格直接编辑功能 - 需求文档

## 简介

这个功能为 MySQL 查询结果表格添加直接编辑能力，用户可以在表格中修改数据并保存，系统自动生成对应的 UPDATE 语句执行。同时引入查询限制机制，防止用户误操作导致查询大量数据，并提供分页功能。

## 需求

### 需求 1：查询结果限制机制

**用户故事：** 作为数据库管理员，我想要限制查询返回的数据量，这样可以防止误查询大量数据导致系统负载过高。

#### 验收标准

1. WHEN 用户执行 SELECT 查询且未指定 LIMIT 子句 THEN 系统 SHALL 自动添加全局配置的默认 LIMIT 值
2. WHEN 用户在全局设置中修改默认查询限制（10-1000）THEN 系统 SHALL 保存新设置并应用于后续查询
3. IF 用户在 SQL 中手动指定了 LIMIT THEN 系统 SHALL 尊重用户指定的 LIMIT 值
4. WHEN 全局查询限制值被设置为小于 10 或大于 1000 THEN 系统 SHALL 拒绝保存并显示错误提示
5. WHEN 查询被自动限制后 THEN 系统 SHALL 在界面上显示"已限制前 N 条"的提示信息

### 需求 2：表格单元格直接编辑

**用户故事：** 作为数据库用户，我想要直接在查询结果表格中点击单元格编辑数据，这样可以更方便地修改数据。

#### 验收标准

1. WHEN 用户点击表格中的可编辑单元格 THEN 系统 SHALL 进入编辑模式并显示输入框
2. WHEN 用户点击主键列或不可编辑的数据类型（如 BLOB、JSON）THEN 系统 SHALL 不允许编辑
3. WHEN 用户在编辑模式下按 Enter 键 THEN 系统 SHALL 保存当前修改并退出编辑模式
4. WHEN 用户在编辑模式下按 Esc 键 THEN 系统 SHALL 取消修改并退出编辑模式
5. IF 单元格内容过长 THEN 系统 SHALL 显示截断内容并在编辑时显示完整内容

### 需求 3：保存修改为 SQL 更新

**用户故事：** 作为数据库用户，我想要通过明确的保存按钮来提交修改，这样可以避免误操作并清楚地知道数据何时被更新。

#### 验收标准

1. WHEN 用户修改了至少一个单元格 THEN 系统 SHALL 启用"保存修改"按钮
2. WHEN 用户点击"保存修改"按钮 THEN 系统 SHALL 生成对应的 UPDATE 语句并显示确认对话框
3. WHEN 用户确认保存 THEN 系统 SHALL 执行生成的 UPDATE 语句
4. IF UPDATE 语句执行成功 THEN 系统 SHALL 刷新查询结果并显示成功提示
5. IF UPDATE 语句执行失败 THEN 系统 SHALL 显示错误信息并保留用户修改
6. WHEN 用户点击"放弃修改"按钮 THEN 系统 SHALL 丢弃所有未保存的修改并恢复原始数据
7. WHEN 系统生成 UPDATE 语句 THEN 系统 SHALL 使用表的主键作为 WHERE 条件

### 需求 4：分页功能

**用户故事：** 作为数据库用户，我想要通过分页浏览查询结果，这样可以方便地查看被限制的数据。

#### 验收标准

1. WHEN 查询结果达到限制数量 THEN 系统 SHALL 显示分页控件
2. WHEN 用户点击分页控件 THEN 系统 SHALL 执行带 OFFSET 的查询获取对应页数据
3. WHEN 分页查询执行时 THEN 系统 SHALL 在原 SQL 基础上添加 OFFSET 和 LIMIT 子句
4. WHEN 用户在第一页 THEN 系统 SHALL 禁用"上一页"按钮
5. WHEN 用户在最后一页 THEN 系统 SHALL 禁用"下一页"按钮
6. WHEN 分页查询执行时 THEN 系统 SHALL 显示当前页码和总页数

### 需求 5：全局查询限制设置

**用户故事：** 作为系统管理员，我想要在全局设置中配置默认查询限制，这样可以控制系统的默认行为。

#### 验收标准

1. WHEN 用户打开设置页面 THEN 系统 SHALL 显示 MySQL 查询限制配置项
2. WHEN 用户修改查询限制值 THEN 系统 SHALL 验证值在 10-1000 范围内
3. WHEN 用户保存有效的查询限制值 THEN 系统 SHALL 将配置保存到 localStorage
4. WHEN 系统启动时 THEN 系统 SHALL 从 localStorage 读取查询限制配置
5. IF localStorage 中没有配置 THEN 系统 SHALL 使用默认值 100

## 非功能需求

### 性能

- 单次查询响应时间应在 5 秒内完成
- 表格编辑操作不应有明显延迟（< 100ms）

### 用户体验

- 所有保存操作都需要明确确认
- 提供清晰的视觉反馈显示哪些单元格已被修改
- 支持键盘快捷键（Enter 保存、Esc 取消）

### 安全

- 不允许编辑主键列
- 不允许编辑不可变的数据类型
- 所有 UPDATE 操作都应记录在查询历史中
